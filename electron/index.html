<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Pentest Desktop ‚Äî MVP</title>
  <style>
    body {
      font-family: Inter, system-ui, sans-serif;
      margin: 18px;
    }

    input,
    button {
      font-size: 14px;
      padding: 8px;
      margin: 6px 0;
    }

    #out {
      white-space: pre-wrap;
      background: #111;
      color: #eee;
      padding: 12px;
      border-radius: 6px;
      height: 300px;
      overflow: auto;
    }
  </style>
</head>

<body>
  <h2>Pentest Desktop ‚Äî MVP</h2>
  <label>Tool (allowed: dummy-wasm)</label><br />
  <input id="tool" placeholder="tool name" value="dummy-wasm" /><br />
  <label>Target</label><br />
  <input id="target" placeholder="127.0.0.1" value="127.0.0.1" /><br />
  <button id="run">Run</button>
  <button id="runStream">Run Streamed</button>
  <h3>Output</h3>
  <div id="out">‚Äî</div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const outEl = document.getElementById('out');

      document.getElementById('runStream').onclick = () => {
        const tool = document.getElementById('tool').value.trim();
        const target = document.getElementById('target').value.trim();

        if (!tool || !target) {
          outEl.textContent = "Tool and target required";
          return;
        }

        outEl.textContent = "[Connecting...]\n";
        console.log("üî• Renderer: Creating EventSource...");

        // ‚ùó USE runStream ‚Äî NOT getStreamUrl
        const evtSource = window.api.runStream(tool, target);
        console.log("üî• Renderer: EventSource created, readyState =", evtSource.readyState);

        evtSource.onopen = () => {
          console.log("‚úÖ Renderer: EventSource OPENED");
          outEl.textContent = "[Stream opened]\n";
        };

        evtSource.onmessage = (event) => {
          console.log("üì© Renderer message:", event.data);
          outEl.textContent += event.data + "\n";
        };

        evtSource.onerror = (err) => {
          console.error("‚ùå Renderer: EventSource ERROR", err);
          outEl.textContent += "\n[Stream closed or error]\n";
          evtSource.close();
        };
      };
    });
  </script>

  <script src="renderer.js"></script>

</body>

</html>